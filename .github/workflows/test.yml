on: deployment_status
jobs:
  changes:
    runs-on: ubuntu-latest
    outputs:
      a: ${{ steps.filter.outputs.a }}
      b: ${{ steps.filter.outputs.b }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2 # Needed to get previous commit on the branch
      - name: Get current and base commit SHAs
        id: commits
        run: |
          echo "current=$(git rev-parse HEAD)" >> $GITHUB_OUTPUT
          if [ "${{ github.ref_name }}" = "main" ]; then
            echo "base=$(git rev-parse HEAD^)" >> $GITHUB_OUTPUT
          else
            # Find the fork point from main
            base_commit=$(git merge-base origin/main HEAD)
            echo "base=$base_commit" >> $GITHUB_OUTPUT
          fi
      - name: Paths Filter (dorny/paths-filter)
        id: filter
        uses: dorny/paths-filter@v3
        with:
          base: ${{ steps.commits.outputs.base }}
          ref: ${{ steps.commits.outputs.current }}
          filters: |
            a:
              - 'a/**'
            b:
              - 'b/**'
      - name: Print changed files
        run: |
          echo "Changed in 'a': ${{ steps.filter.outputs.a }}"
          echo "Changed in 'b': ${{ steps.filter.outputs.b }}"
  job-a:
    needs: changes
    if: ${{ needs.changes.outputs.a == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "A"

  job-b:
    needs: changes
    if: ${{ needs.changes.outputs.b == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "B"
